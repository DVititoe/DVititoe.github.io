<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Solo Controller: Software Architecture</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Solo Controller<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Documentation for the Solo Controller</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_software__architecture.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Software Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__software___architecture"></a></p>
<h1><a class="anchor" id="autotoc_md34"></a>
Key Software Components</h1>
<p>The following Block Definition Diagram shows the major components of the Solo Controller application. This software is designed to run as a single threaded application.</p>
<center><img src="Solo_App_Structure.png" alt="Components of the Solo Application" width="85%" class="inline"/></center><p>The Solo Controller App uses the <a href="https://tcmenu.github.io/documentation/arduino-libraries/taskmanager-io/">TaskMangerIO</a> library to schedule tasks to be run on the Mega 2560 controller. This provides a convenient mechanism for managing all the individual tasks used by the application. Tasks can scheduled to run at different rates. So, as an example, user interface tasks can be scheduled to run frequently to ensure the UI is responsive. However, sensor tasks can be read at a slower rate, since these values are expected to change more slowly.</p>
<p>All of the tasks run by TaskMangerIO are run sequentially within a single thread. So, only one object/function/task can be running at any one time. Therefore there is no need to protect the global data structures (temperatures, volume readings, etc) with mutex or semaphore protections.</p>
<p>The various other classes used by the application include:</p>
<ul>
<li><b>TempSensor</b>: Interface to the PT100 RTD temperature probes</li>
<li><b>VolSensor</b>: Interface to the volume sensor installed in the Kettle</li>
<li><b>AlarmManage</b>: Monitors sensor values against set values. Triggers audible alarms when out of bounds. Notifies <a class="el" href="class_solo_menu.html">SoloMenu</a> of alarm conditions</li>
<li><b>PID_Manager</b>: (TBD)</li>
<li><b><a class="el" href="class_solo_menu.html">SoloMenu</a></b> Collection of User Interface classes, described in more detail below.</li>
</ul>
<p>The following object diagram shows how these components interact with one another:</p>
<center><img src="Solo_Object_Diagram.png" alt="Interactions between primary objects within the Solo App" width="85%" class="inline"/></center><p>Upon startup, the application will register a number of default tasks with the TaskManager. These tasks handle basic functionality such as updating the user interface, reading temperature and volume sensors, and monitoring for alarms.</p>
<p>The user interacts with the application via the TFT touch screen display. If possible, <a class="el" href="class_solo_menu.html">SoloMenu</a> will respond directly to user requests. In some cases, <a class="el" href="class_solo_menu.html">SoloMenu</a> will implement the behavior by sending a new task to TaskManager. Some examples of tasks that could be generated by <a class="el" href="class_solo_menu.html">SoloMenu</a>, include turn on/off temperature PIDs and turning on/off the system alarm.</p>
<p>Note that user interface graphics and font imagery is not passed between objects. The SPI interfaces used by the electronics just isn't fast enough to efficiently transfer this data in a timely fashion. Instead, the images uses by the UI are either either stored in TFT ROM or is generated by the TFT/LT7683 graphics engine. The resulting images are loaded into TFT RAM, making it available to <a class="el" href="class_solo_menu.html">SoloMenu</a>.</p>
<h1><a class="anchor" id="autotoc_md35"></a>
User Interface Classes</h1>
<p>The classes that implement the menu system for the Solo Controller app are shown in the following diagram:</p>
<center><img src="Solo_App_Class_Diagram.png" alt="Class Diagram for the Solo App" width="85%" class="inline"/></center><p><a class="el" href="class_solo_menu.html">SoloMenu</a> is an abstract base used by all menu objects. <a class="el" href="class_solo_menu.html">SoloMenu</a> defines the common methods used by all menu classes. It also provides a basic button management capability. Derived menus just need to register their buttons with <a class="el" href="class_solo_menu.html">SoloMenu</a>. <a class="el" href="class_solo_menu.html">SoloMenu</a> will track screen touches by the user, checking to see if one of the registered buttons has been pressed. Once a button is pressed, the buttons callback function is called.</p>
<p>Low level functions that drive the TFT/LT7683 graphics chip are contained within <a class="el" href="namespace_t_f_t_m070_a1.html">TFTM070A1</a> class. This is a slight repackaging of the low level functions provided by <a href="https://www.buydisplay.com/">BuyDisplay.com</a> for use with their <a href="https://dvititoe.github.io/Solo_Controller/html/docs/ER-TFT070A2-6-5633_Datasheet.pdf">ER-TFT070A2-6-5633</a> TFT. The SoloCanvas class provides higher level TFT/RAM management functionality. The menu objects use SoloCanvas to load, display, and manipulate imagery stored in TFT RAM. This insulates the menu classes from the lower-level graphics display details. Instead, the only need to interact with the simpler interface provided by SoloCanvas.</p>
<p>Each menu consists of:</p>
<ul>
<li>Background imagery, which is stored managed by a SoloCanvas object</li>
<li>Dynamic text, provided by the <a class="el" href="class_dynamic_text.html">DynamicText</a> and <a class="el" href="class_text_box.html">TextBox</a> objects</li>
<li>Buttons, provided by the various button classes shown in the following diagram</li>
</ul>
<center><img src="Solo_App_Button_Classes.png" alt="Button Classes used by the Solo App" width="85%" class="inline"/></center><p>The base <a class="el" href="class_button.html">Button</a> class handle core functionality such as graphics updates, button presses/releases, and initiation of callback functions. There are a number of derived button classes that provide buttons with slightly different behaviors:</p>
<ul>
<li><b><a class="el" href="class_toggle_button.html">ToggleButton</a></b>: Has two States: on/off. Each state has it's own callback function. The callback functions are called whenever the button is <em>pressed</em>. Examples: Pump on/off button and Alarm on/off button</li>
<li><b><a class="el" href="class_momentary_button.html">MomentaryButton</a></b>: Has two States: on/off. Each state has it's own callback function. The "on" callback function is called whenever the button is <em>pressed</em>. The "off" callback function is called whenever the button is <em>released</em>. Examples: <a class="el" href="namespace_setup.html" title="Contains setup functions for the Solo Controller application.">Setup</a> button on the main menu (<a class="el" href="namespace_setup.html" title="Contains setup functions for the Solo Controller application.">Setup</a> menu appears after user releases the button).</li>
<li><b><a class="el" href="class_immediate_button.html">ImmediateButton</a></b>: Has a single state and a single callback function. The callback function is called whenever the button is <em>pressed</em>. Examples: Buttons that switch between setup menus</li>
<li><b><a class="el" href="class_text_box.html">TextBox</a></b>: Dynamic text that is also an <a class="el" href="class_immediate_button.html">ImmediateButton</a>. When the button is pressed, the DataEntry dialog appears, giving users the ability to update/change numerical values. Example: Kettle set temperature.</li>
</ul>
<h1><a class="anchor" id="autotoc_md36"></a>
Font Classes</h1>
<p><em><b>Future Section....</b></em></p>
<h1><a class="anchor" id="autotoc_md37"></a>
Software Dependencies</h1>
<p>The following diagram shows the dependencies between the major c++ header and cpp files in the project. The goal with this analysis was to avoid circular dependencies and, where possible, eliminate unnecessary dependencies between files.</p>
<center><img src="Solo_App_Header_Dependency.png" alt="Dependency Diagram showing the relationship between c++ header files" width="85%" class="inline"/></center><p>Note that <a class="el" href="main_8cpp.html">main.cpp</a> only uses <em>TaskManagerIO.h</em> and <em><a class="el" href="_tasks_8h.html">Tasks.h</a></em>. This means that <a class="el" href="main_8cpp.html">Main.cpp</a> does not have access to the alarms, sensors, menus, and canvases used by the application. It only needs to understand how to schedule tasks with the TaskManager. The file that implements the Tasks, <em><a class="el" href="_tasks_8cpp.html">Tasks.cpp</a></em>, is responsible for interacting with the alarms, sensors, and menu objects used by the app.</p>
<p>Common parameters, such as Arduino pin definitions, are contained within <a class="el" href="_common_8h.html">Common.h</a></p>
<p><em><b>TBD Section...</b></em>: Need to update this write-up once I finish updating the menu system. How does menu access data values? </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
